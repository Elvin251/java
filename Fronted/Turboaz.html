<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Turbo System</title>

<style>

body{
font-family: Arial;
background:#f2f2f2;
margin:0;
}

header{
background:#d32f2f;
color:white;
padding:15px;
text-align:center;
}

.container{
width:400px;
margin:20px auto;
background:white;
padding:20px;
border-radius:8px;
box-shadow:0 0 5px gray;
}

input{
width:100%;
padding:10px;
margin:5px 0;
border:1px solid gray;
border-radius:5px;
}

button{
width:100%;
padding:10px;
background:#d32f2f;
color:white;
border:none;
border-radius:5px;
cursor:pointer;
}

button:hover{
background:#b71c1c;
}

.ad{
background:#eee;
padding:10px;
margin:10px 0;
border-radius:5px;
}

.hidden{
display:none;
}

</style>

</head>

<body>

<header>
<h2>Turbo.az System</h2>
</header>

<div class="container">

<h3>Register</h3>
<input id="regUsername" placeholder="Username">
<input id="regPassword" placeholder="Password">
<button onclick="register()">Register</button>

<hr>

<h3>Login</h3>
<input id="loginUsername" placeholder="Username">
<input id="loginPassword" placeholder="Password">
<button onclick="login()">Login</button>

</div>

<div class="container hidden" id="adPanel">

<h3>Add Advertisement</h3>

<input id="brand" placeholder="Brand">
<input id="model" placeholder="Model">
<input id="year" placeholder="Year">
<input id="price" placeholder="Price">
<input id="city" placeholder="City">

<button onclick="addAd()">Add Advertisement</button>

<hr>

<h3>Advertisements</h3>
<div id="adList"></div>

</div>

<script>

const API = "http://localhost:8080";

function register(){

fetch(API + "/auth/register",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
username:regUsername.value,
password:regPassword.value
})
})
.then(()=>alert("Registered"))
}

function login(){

let token = btoa(loginUsername.value + ":" + loginPassword.value);

localStorage.setItem("auth",token);

adPanel.classList.remove("hidden");

loadAds();
}

function addAd(){

fetch(API + "/ads",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Basic " + localStorage.getItem("auth")
},
body:JSON.stringify({
brand:brand.value,
model:model.value,
year:year.value,
price:price.value,
city:city.value
})
})
.then(()=>{
alert("Advertisement Added");
loadAds();
})
}

function loadAds(){

fetch(API + "/ads",{
headers:{
"Authorization":"Basic " + localStorage.getItem("auth")
}
})
.then(r=>r.json())
.then(data=>{

adList.innerHTML="";

data.forEach(ad=>{

adList.innerHTML += `
<div class="ad">
<b>${ad.brand} ${ad.model}</b><br>
Year: ${ad.year}<br>
Price: ${ad.price}<br>
City: ${ad.city}
</div>
`

})

})
}

</script>

</body>
</html>
